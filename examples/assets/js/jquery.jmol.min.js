/*
 * jMol - jQuery Plugin
 * Complete replacement for Jmol.js
 * 
 * Copyright (c) 2012 Gusts 'gusC' Kaksis
 * 
 * Version: 1.1.0 (12/07/2012)
 * Requires: jQuery v1.4+
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 */

var JmolCallbackWrapper=function(a){var b=function(b){a("#"+b.substr(1))._jmol_cb("ready",arguments)},c=function(b){a("#"+b.substr(1)).triggerHandler("hover",k(arguments[2],arguments[1]))},d=function(b){a("#"+b.substr(1)).triggerHandler("pick",k(arguments[2],arguments[1]))},e=function(b){var c={url:arguments[1],file_name:arguments[2],name:arguments[3],err_msg:arguments[4],err_no:arguments[5],frame_prev:arguments[6],frame_last:arguments[7]};a("#"+b.substr(1)).triggerHandler("load",c)},f=function(b){switch(arguments[3]){case"measurePicked":var c={type:"unknown",value:arguments[4]};c["value"]=arguments[4];if(arguments[2]==2){c["type"]="distance"}else if(arguments[2]==3){c["type"]="angle"}else if(arguments[2]==4){c["type"]="torsion"}a("#"+b.substr(1)).triggerHandler("measure",c);break}},g=function(b){a("#"+b.substr(1))._jmol_cb("echo",arguments)},h=function(b){a("#"+b.substr(1))._jmol_cb("message",arguments)},i=function(b){a("#"+b.substr(1))._jmol_cb("script",arguments)},j=function(b){return a("#"+b.substr(1))._jmol_cb("sync",arguments)},k=function(a,b){var c=b.split(" ");return{index:parseInt(a),name:c[0],num:c[1],coords:{x:parseFloat(c[2]),y:parseFloat(c[3]),z:parseFloat(c[4])}}};return{cbReady:b,cbEcho:g,cbHover:c,cbLoad:e,cbMeasure:f,cbMessage:h,cbPick:d,cbScript:i,cbSync:j}}(jQuery);(function(a){var b=function(){var b={appletUrl:"",useSigned:false,syncId:0,memLimit:512,width:400,height:300,menuUrl:"",modelUrl:"",background:"#000000",onEcho:null,onMessage:null,onScript:null,onSync:function(){return 1}},c="JmolApplet0.jar",d="JmolAppletSigned0.jar",e='<object type="application/x-java-applet" id="%id%" name="%name%" width="%width%" height="%height%"%add_attr%>'+'<param name="syncId" value="%sync_id%"/>'+'<param name="progressbar" value="true">'+'<param name="progresscolor" value="blue">'+'<param name="boxbgcolor" value="%bg_color%"/>'+'<param name="boxfgcolor" value="black">'+'<param name="boxmessage" value="Downloading JmolApplet ...">'+'<param name="mayscript" value="mayscript">'+'<param name="codebase" value="%applet_url%" />'+'<param name="archive" value="%applet_file%" />'+'<param name="code" value="JmolApplet.class" />'+'<param name="java_arguments" value="%java_args%"/>'+'<param name="script" value="%script%"/>'+"%add_param%"+'<param name="appletReadyCallback" value="JmolCallbackWrapper.cbReady" />'+'<param name="hoverCallback" value="JmolCallbackWrapper.cbHover" />'+'<param name="loadStructCallback" value="JmolCallbackWrapper.cbLoad" />'+'<param name="pickCallback" value="JmolCallbackWrapper.cbPick" />'+'<param name="measureCallback" value="JmolCallbackWrapper.cbMeasure" />'+'<param name="syncCallback" value="JmolCallbackWrapper.cbSync" />'+"<p>You do not have Java applets enabled in your web browser, or your browser is blocking this applet.<br>"+"Check the warning message from your browser and/or enable Java applets in<br>"+'your web browser preferences, or install the Java Runtime Environment from <a href="http://www.java.com">www.java.com</a><br></p>'+"</object>",f='<param name="messageCallback" value="JmolCallbackWrapper.cbMessage" />',g='<param name="echoCallback" value="JmolCallbackWrapper.cbEcho" />',h='<param name="scriptCallback" value="JmolCallbackWrapper.cbScript" />',i="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93",j="http://java.sun.com/update/1.6.0/jinstall-6u22-windows-i586.cab",k=0,l={},m={};var n=function(c){var d={};if(typeof c=="object"){d=a.extend({},b,c||{})}else if(typeof c=="undefined"){d=a.extend({},b,{});c=d}var e=this;this.each(function(b,e){var f=a(e);if(f.is(".jmol-initialized")){if(typeof c=="string"){_appletScript(f.attr("id"),c)}else if(typeof c=="object"){_debug("jMol option update not implemented")}}else if(typeof c=="object"){k++;var g=f.attr("id");var h=f.attr("class");if(typeof g=="undefined"){g="jmolApplet"+k;f.attr("id",g)}if(d["syncId"]<=0){d["syncId"]=k}f.html(_appletBuildHtml("_"+g,d));l[g]=d;f.addClass("jmol-initialized")}else{_debug("Error in initializing jMol")}});return e},o=function(b,c){var d=a(this).attr("id");var e=l[d];switch(b){case"ready":if(c[2]){m[d]=c[3];this.triggerHandler("ready",c[1])}else{delete m[d];delete l[d];this.triggerHandler("destroy",c[1])}break;case"echo":e.onEcho(c[1]);break;case"message":e.onMessage(c);break;case"script":e.onScript(c);break;case"sync":return e.onSync()}},p=function(a){if(typeof m[a]!="undefined"){return m[a]}else{var b=document;if(b.getElementById(a))return b.getElementById(a);else if(b.applets)return b.applets[a];else return b[a]}};_appletScript=function(a,b){var c=p(a);if(c){if(typeof c.script!="undefined"){c.script(b);c=null;return true}else{_debug("Oppsy daisy, Jmol has no method script()")}}else{_debug("Oppsy daisy, Jmol was not found")}c=null;return false},_appletBuildHtml=function(a,b){var k="";if(navigator.userAgent){if(navigator.userAgent.indexOf("MSIE")!=-1){k=' classid="'+i+'" codebase="'+j+'"'}}var l="";if(navigator.platform){if(navigator.platform.indexOf("Mac")!=-1){l='<param name="UseCommandThread" value="true">'}}if(b["onEcho"]!==null){l+=g}if(b["onScript"]!==null){l+=h}if(b["onMessage"]!==null){l+=f}var m="";if(b["menuUrl"].length>0){m+="load MENU "+b["menuUrl"]+";"}if(b["modelUrl"].length>0){m+="load "+b["modelUrl"]+";"}var n=e.replace("%add_attr%",k);n=n.replace("%add_param%",l);n=n.replace("%sync_id%",b["syncId"]);n=n.replace("%id%",a);n=n.replace("%name%",a);n=n.replace("%width%",b["width"]);n=n.replace("%height%",b["height"]);n=n.replace("%applet_url%",b["appletUrl"]);n=n.replace("%applet_file%",b["useSigned"]?d:c);n=n.replace("%java_args%","-Xmx"+b["memLimit"]+"m");n=n.replace("%bg_color%",b["background"]);n=n.replace("%script%",m);return n},_debug=function(a){if(typeof console=="object"){console.log(a)}else{}};return{proc:n,callback:o}}();a.fn.extend({jmol:b.proc,_jmol_cb:b.callback})})(jQuery)
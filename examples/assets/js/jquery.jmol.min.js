/*
 * jMol - jQuery Plugin
 * Complete replacement for Jmol.js
 * 
 * Copyright (c) 2012 Gusts 'gusC' Kaksis
 * 
 * Version: 1.0.2 alpha (11/07/2012)
 * Requires: jQuery v1.4+
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 */

var JmolCallbackWrapper=function(a){var b=function(b){a("#"+b)._jmol_cb("ready",arguments)},c=function(b){a("#"+b)._jmol_cb("echo",arguments)},d=function(b){a("#"+b)._jmol_cb("hover",arguments)},e=function(b){a("#"+b)._jmol_cb("load",arguments)},f=function(b){a("#"+b)._jmol_cb("measure",arguments)},g=function(b){a("#"+b)._jmol_cb("message",arguments)},h=function(b){a("#"+b)._jmol_cb("pick",arguments)},i=function(b){a("#"+b)._jmol_cb("script",arguments)},j=function(b){return a("#"+b)._jmol_cb("sync",arguments)};return{cbReady:b,cbEcho:c,cbHover:d,cbLoad:e,cbMeasure:f,cbMessage:g,cbPick:h,cbScript:i,cbSync:j}}(jQuery);(function(a){var b=function(){var b={appletUrl:"",useSigned:false,syncId:0,memLimit:512,width:400,height:300,menuUrl:"",modelUrl:"",background:"#000000",onReady:function(a){},onDestroy:function(a){},onEcho:function(a){},onHover:function(a,b){},onLoad:function(a,b,c,d,e,f,g){},onMeasure:function(a){},onMessage:function(a){},onPick:function(a){},onScript:function(a){},onSync:function(a){return 1}},c="JmolApplet0.jar",d="JmolAppletSigned0.jar",e='<object type="application/x-java-applet" id="%id%" name="%name%" class="jmol-initialized%class%" width="%width%" height="%height%"%add_attr%>'+'<param name="syncId" value="%sync_id%"/>'+'<param name="progressbar" value="true">'+'<param name="progresscolor" value="blue">'+'<param name="boxbgcolor" value="%bg_color%"/>'+'<param name="boxfgcolor" value="black">'+'<param name="boxmessage" value="Downloading JmolApplet ...">'+'<param name="mayscript" value="mayscript">'+'<param name="codebase" value="%applet_url%" />'+'<param name="archive" value="%applet_file%" />'+'<param name="code" value="JmolApplet.class" />'+'<param name="java_arguments" value="%java_args%"/>'+'<param name="script" value="%script%"/>'+"%add_param%"+'<param name="appletReadyCallback" value="JmolCallbackWrapper.cbReady" />'+'<param name="echoCallback" value="JmolCallbackWrapper.cbEcho" />'+'<param name="hoverCallback" value="JmolCallbackWrapper.cbHover" />'+'<param name="loadStructCallback" value="JmolCallbackWrapper.cbLoad" />'+'<param name="measureCallback" value="JmolCallbackWrapper.cbMeasure" />'+'<param name="messageCallback" value="JmolCallbackWrapper.cbMessage" />'+'<param name="pickCallback" value="JmolCallbackWrapper.cbPick" />'+'<param name="scriptCallback" value="JmolCallbackWrapper.cbScript" />'+'<param name="syncCallback" value="JmolCallbackWrapper.cbSync" />'+"<p>You do not have Java applets enabled in your web browser, or your browser is blocking this applet.<br>"+"Check the warning message from your browser and/or enable Java applets in<br>"+'your web browser preferences, or install the Java Runtime Environment from <a href="http://www.java.com">www.java.com</a><br></p>'+"</object>",f="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93",g="http://java.sun.com/update/1.6.0/jinstall-6u22-windows-i586.cab",h=0,i={},j={};var k=function(c){var d={};if(typeof c=="object"){d=a.extend({},b,c||{})}else if(typeof c=="undefined"){d=a.extend({},b,{});c=d}var e=this;this.each(function(b,e){var f=a(e);if(f.is(".jmol-initialized")){if(typeof c=="string"){_appletScript(f.attr("id"),c)}else if(typeof c=="object"){_debug("jMol option update not implemented")}}else if(typeof c=="object"){h++;var g=f.attr("id");var j=f.attr("class");if(typeof g=="undefined"){g="jmolApplet"+h}if(typeof j=="undefined"){j=""}else{j=" "+j}if(d["syncId"]<=0){d["syncId"]=h}$applet=a(_appletBuildHtml(g,j,d));f.after($applet);f.remove();f=$applet;i[g]=d;$applet=null}else{_debug("Error in initializing jMol")}});return e},l=function(a,b){var c=i[b[0]];switch(a){case"ready":if(b[2]){j[b[0]]=b[3];c.onReady(b[1])}else{j[b[0]]=null;c.onDestroy(b[1])}break;case"echo":c.onEcho(b[1]);break;case"hover":c.onHover(b[1],b[2]);break;case"load":c.onLoad(b[1],b[2],b[3],b[4],b[5],b[6],b[7]);break;case"measure":c.onMeasure(b[1]);break;case"message":c.onMessage(b[1]);break;case"pick":var d=b[1].split(" ");var e={id:d[0],num:d[1],coords:{x:parseFloat(d[2]),y:parseFloat(d[3]),z:parseFloat(d[4])}};c.onPick(e);break;case"script":c.onScript(b[1]);break}},m=function(a){if(typeof j[a]!="undefined"){return j[a]}else{var b=document;if(b.getElementById(a))return b.getElementById(a);else if(b.applets)return b.applets[a];else return b[a]}};_appletScript=function(a,b){var c=m(a);if(c){if(typeof c.script=="function"){c.script(b);c=null;return true}else{_debug("Oppsy daisy, Jmol has no method script()")}}else{_debug("Oppsy daisy, Jmol was not found")}c=null;return false},_appletBuildHtml=function(a,b,h){var i="";if(navigator.userAgent){if(navigator.userAgent.indexOf("MSIE")!=-1){i=' classid="'+f+'" codebase="'+g+'"'}}var j="";if(navigator.platform){if(navigator.platform.indexOf("Mac")!=-1){j='<param name="UseCommandThread" value="true">'}}var k="";if(h["menuUrl"].length>0){k+="load MENU "+h["menuUrl"]+";"}if(h["modelUrl"].length>0){k+="load "+h["modelUrl"]+";"}var l=e.replace("%add_attr%",j);l=l.replace("%add_param%",j);l=l.replace("%sync_id%",h["syncId"]);l=l.replace("%id%",a);l=l.replace("%name%",a);l=l.replace("%class%",b);l=l.replace("%width%",h["width"]);l=l.replace("%height%",h["height"]);l=l.replace("%applet_url%",h["appletUrl"]);l=l.replace("%applet_file%",h["useSigned"]?d:c);l=l.replace("%java_args%","-Xmx"+h["memLimit"]+"m");l=l.replace("%bg_color%",h["background"]);l=l.replace("%script%",k);return l},_debug=function(a){if(typeof console=="object"){console.log(a)}else{}};return{proc:k,callback:l}}();a.fn.extend({jmol:b.proc,_jmol_cb:b.callback})})(jQuery)
/*
 * jQueryJmol - jQuery Plugin
 * Complete replacement for Jmol.js
 * 
 * Copyright (c) 2012 Gusts 'gusC' Kaksis
 * 
 * Version: 1.3.0 (05/08/2012)
 * Requires: jQuery v1.4+
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 */

var _jQueryJmolRouter=function(a){var b=function(b){a("#"+b.substr(1))._jmol_cb("eval",arguments)},c=function(b){a("#"+b.substr(1))._jmol_cb("message",arguments)},d=function(b){a("#"+b.substr(1))._jmol_cb("echo",arguments)},e=function(b){a("#"+b.substr(1))._jmol_cb("script",arguments)},f=function(b){return a("#"+b.substr(1))._jmol_cb("sync",arguments)},g=function(b){a("#"+b.substr(1))._jmol_cb("ready",arguments)},h=function(b){a("#"+b.substr(1)).triggerHandler("load",arguments)},i=function(b){a("#"+b.substr(1)).triggerHandler("hover",arguments)},j=function(b){a("#"+b.substr(1)).triggerHandler("pick",arguments)},k=function(b){a("#"+b.substr(1)).triggerHandler("measure",arguments)},l=function(b){a("#"+b.substr(1)).triggerHandler("animate",arguments)},m=function(b){a("#"+b.substr(1)).triggerHandler("minimize",arguments)},n=function(b){a("#"+b.substr(1)).triggerHandler("resize",arguments)};return{cbEval:b,cbMessage:c,cbEcho:d,cbScript:e,cbSync:f,cbReady:g,cbLoad:h,cbHover:i,cbPick:j,cbMeasure:k,cbAnim:l,cbMin:m,cbResize:n}}(jQuery);(function(a){var b=function(){var b=["ready","destroy","load","hover","pick","measure","animate","minimize","resize"];var c={appletUrl:"",useSigned:false,memLimit:512,width:400,height:300,menuUrl:"",modelUrl:"",background:"#000000",events:null,onEcho:null,onMessage:null,onScript:null,onSync:null,onEval:null},d="JmolApplet0.jar",e="JmolAppletSigned0.jar",f='<object type="application/x-java-applet" id="%id%" name="%name%" width="%width%" height="%height%"%add_attr%>'+'<param name="syncId" value="%sync_id%"/>'+'<param name="progressbar" value="true">'+'<param name="progresscolor" value="blue">'+'<param name="boxbgcolor" value="%bg_color%"/>'+'<param name="boxfgcolor" value="black">'+'<param name="boxmessage" value="Downloading JmolApplet ...">'+'<param name="mayscript" value="mayscript">'+'<param name="codebase" value="%applet_url%" />'+'<param name="archive" value="%applet_file%" />'+'<param name="code" value="JmolApplet.class" />'+'<param name="java_arguments" value="%java_args%"/>'+"%add_param%"+"<p>You do not have Java applets enabled in your web browser, or your browser is blocking this applet.<br>"+"Check the warning message from your browser and/or enable Java applets in<br>"+'your web browser preferences, or install the Java Runtime Environment from <a href="http://www.java.com">www.java.com</a><br></p>'+"</object>",g={hover:"HoverCallback _jQueryJmolRouter.cbHover",load:"LoadStructCallback jQueryJmolRouter.cbLoad",pick:"PickCallback jQueryJmolRouter.cbPick",measure:"MeasureCallback jQueryJmolRouter.cbMeasure",sync:"SyncCallback jQueryJmolRouter.cbSync",msg:"MessageCallback jQueryJmolRouter.cbMessage",echo:"EchoCallback jQueryJmolRouter.cbEcho",script:"ScriptCallback jQueryJmolRouter.cbScript",anim:"AnimFrameCallback jQueryJmolRouter.cbAnim",min:"MinimizationCallback jQueryJmolRouter.cbMin",resize:"ResizeCallback jQueryJmolRouter.cbResize"},h={ready:'<param name="appletReadyCallback" value="_jQueryJmolRouter.cbReady" />',eval:'<param name="evalCallback" value="_jQueryJmolRouter.cbEval" />'},i="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93",j="http://java.sun.com/update/1.6.0/jinstall-6u22-windows-i586.cab",k=0,l={},m={},n=true;var o=function(b){return this.each(function(d,e){var f=a(e);if(f.data("jmol")){if(typeof b=="string"){var h=f.attr("id");switch(b){case"hide":f.find("object").css("width","2px");f.find("object").css("height","2px");break;case"show":var i=l[h]["options"];f.find("object").css("width",i["width"]+"px");f.find("object").css("height",i["height"]+"px");break;case"destroy":var j=r(h);if(j){if(typeof j.script!="undefined"){}}j=null;delete l[h]["applet"];delete l[h]["options"];delete m[h];f.find("object").remove();break}}else if(typeof b=="object"){var h=f.attr("id");var i=l[h]["options"];for(var n in b){switch(n){case"background":_appletScript(h,"background "+b[n].replace("#","x"));break;case"menuUrl":_appletScript(h,'load MENU "'+b[n]+'"');break;case"modelUrl":_appletScript(h,'load "'+b[n]+'"');break}i[n]=b}l[h]["options"]=i}}else{var i=a.extend({},c,{});if(typeof b=="object"){i=a.extend(i,b||{})}k++;var h=f.attr("id");if(typeof h=="undefined"){h="jmolApplet"+k;f.attr("id",h)}l[h]={options:i,applet:null};m[h]=new Array;if(i["menuUrl"]!=null&&i["menuUrl"].length>0){m[h].push("load MENU "+i["menuUrl"])}if(i["modelUrl"]!=null&&i["modelUrl"].length>0){m[h].push("load "+i["modelUrl"])}if(i["events"]!=null&&i["events"].length>0){for(var n in i["events"]){if(typeof g[i["events"][n]]!="undefined"){m[h].push("set "+g[i["events"][n]])}}}if(i["onEcho"]!=null){m[h].push("set "+g["echo"])}if(i["onScript"]!=null){m[h].push("set "+g["script"])}if(i["onMessage"]!=null){m[h].push("set "+g["message"])}if(i["onSync"]!=null){m[h].push("set "+g["sync"])}f.html(_appletBuildHtml("_"+h,i));f.data("jmol",true)}})},p=function(b){return this.each(function(c,d){var e=a(d);var f=e.attr("id");if(e.data("jmol")){if(typeof b=="string"){_appletScript(f,b)}else if(typeof b=="object"){for(var g in b){_appletScript(f,b[g])}}}else{if(typeof m[f]!="object"){m[f]=new Array}if(typeof b=="string"){m[f].push(b)}else if(typeof b=="object"){for(var g in b){m[f].push(b[g])}}}})},q=function(b,c){var d=a(this).attr("id");var e=l[d]["options"];switch(b){case"ready":if(c[2]){l[d]["applet"]=c[3];if(typeof m[d]!="undefined"){var f=m[d];for(var g in f){_appletScript(d,f[g])}delete m[d]}this.triggerHandler("ready",c[1])}else{this.triggerHandler("destroy",c[1]);delete l[d]}break;case"eval":if(e["onEval"]!=null){e.onEval(c)}break;case"echo":if(e["onEcho"]!=null){e.onEcho(c)}break;case"message":if(e["onMessage"]!=null){e.onMessage(c)}break;case"script":if(e["onScript"]!=null){e.onScript(c)}break;case"sync":if(e["onSync"]!=null){return e.onSync()}return 1;break}},r=function(a){if(typeof l[a]!="undefined"){if(l[a]["applet"]!==null){return l[a]["applet"]}}var b=document;if(b.getElementById(a))return b.getElementById(a);else if(b.applets)return b.applets[a];else return b[a]};_appletScript=function(a,b){var c=r(a);if(c){if(typeof c.script!="undefined"){c.script(b);c=null;return true}else{_debug("Oppsy daisy, Jmol has no method script()")}}else{_debug("Oppsy daisy, Jmol was not found")}c=null;return false},_appletBuildHtml=function(a,b){var c="";if(navigator.userAgent){if(navigator.userAgent.indexOf("MSIE")!=-1){c=' classid="'+i+'" codebase="'+j+'"'}}var g="";if(navigator.platform){if(navigator.platform.indexOf("Mac")!=-1){g='<param name="UseCommandThread" value="true">'}}g+=h["ready"];if(b["onEval"]!==null){g+=h["eval"]}var k=f.replace("%add_attr%",c);k=k.replace("%add_param%",g);k=k.replace("%sync_id%",(""+Math.random()).substring(3));k=k.replace("%id%",a);k=k.replace("%name%",a);k=k.replace("%width%",b["width"]);k=k.replace("%height%",b["height"]);k=k.replace("%applet_url%",b["appletUrl"]);k=k.replace("%applet_file%",b["useSigned"]?e:d);k=k.replace("%java_args%","-Xmx"+b["memLimit"]+"m");k=k.replace("%bg_color%",b["background"]);return k},_debug=function(a){if(n){if(typeof console=="object"){console.log(a)}else{if(typeof a=="object"){var b="";for(var c in a){b+=c+": "+a[c]+"\n"}a=b}alert(a)}}};return{init:o,script:p,callback:q}}();a.fn.extend({jmol:b.init,jmolscript:b.script,_jmol_cb:b.callback})})(jQuery)
/*
 * jQueryJmol - jQuery Plugin
 * Complete replacement for Jmol.js
 * 
 * Copyright (c) 2012 Gusts 'gusC' Kaksis
 * 
 * Version: 2.0.0 (10/08/2012)
 * Requires: jQuery v1.6+
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 */

(function(a){var b=function(a,b){this.id=a;this.options=b;this._applet=null;this._callbackCounter={};this._callbackNames={animate:"AnimFrameCallback",echo:"EchoCallback",hover:"HoverCallback",load:"LoadStructCallback",measure:"MeasureCallback",message:"MessageCallback",minimize:"MinimizationCallback",pick:"PickCallback",resize:"ResizeCallback",sync:"SyncCallback",script:"ScriptCallback"};this._scriptCache=[];this.getProperty=function(a,b){var c="[]";if(this._applet){if(typeof b!="undefined"){c=this._applet.getPropertyAsJSON(a,b)}else{c=this._applet.getPropertyAsJSON(a)}}return jQuery.parseJSON(c)};this.script=function(a){if(this._applet){this._applet.script(a)}else{this._scriptCache.push(a)}};this.scriptWait=function(a,b){if(this._applet){if(typeof b!="undefined"){return this._applet.scriptWait(a,b)}else{return this._applet.scriptWait(a)}}return""};this.scriptWaitOutput=function(a){if(this._applet){return this._applet.scriptWaitOutput(a)}return""};this.scriptNoWait=function(a){if(this._applet){return this._applet.scriptNoWait(a)}return""};this.scriptCheck=function(a){if(this._applet){return this._applet.scriptCheck(a)}return""};this._ready=function(a){this._applet=a;if(this._scriptCache.length>0){for(var b in this._scriptCache){this._applet.script(this._scriptCache[b])}}this._scriptCache=[]};this._destroy=function(){delete this._scriptCache;delete this._applet;delete this.options;delete this.id};this._setCallback=function(a){if(typeof this._callbackCounter[a]=="undefined"){this._callbackCounter[a]=1;this.script("set "+this._callbackNames[a]+' "jQuery.jmol.'+a+'"')}this._callbackCounter[a]++};this._removeCallback=function(a){if(typeof this._callbackCounter[a]!="undefined"){this._callbackCounter[a]--;if(this._callbackCounter[a]<=0){this.script("set "+this._callbackNames[a]+" NONE")}}}};var c=function(){var c={appletUrl:"",useSigned:false,memLimit:512,width:400,height:300,menuUrl:"",modelUrl:"",background:"#000000",onReady:null,onDestroy:null,onSync:null,onEval:null},d="JmolApplet0.jar",e="JmolAppletSigned0.jar",f='<object type="application/x-java-applet" id="%id%" name="%name%" width="%width%" height="%height%"%add_attr%>'+'<param name="syncId" value="%sync_id%"/>'+'<param name="progressbar" value="true">'+'<param name="progresscolor" value="blue">'+'<param name="boxbgcolor" value="%bg_color%"/>'+'<param name="boxfgcolor" value="black">'+'<param name="boxmessage" value="Downloading JmolApplet ...">'+'<param name="mayscript" value="mayscript">'+'<param name="codebase" value="%applet_url%" />'+'<param name="archive" value="%applet_file%" />'+'<param name="code" value="JmolApplet.class" />'+'<param name="java_arguments" value="%java_args%"/>'+"%add_param%"+"<p>You do not have Java applets enabled in your web browser, or your browser is blocking this applet.<br>"+"Check the warning message from your browser and/or enable Java applets in<br>"+'your web browser preferences, or install the Java Runtime Environment from <a href="http://www.java.com">www.java.com</a><br></p>'+"</object>",g={eval:'<param name="evalCallback" value="$.jmol.eval" />',ready:'<param name="appletReadyCallback" value="$.jmol.ready" />'},h="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93",i="http://java.sun.com/update/1.6.0/jinstall-6u22-windows-i586.cab",j=0;var k=function(d){return this.each(function(e,f){var g=a(f);if(g.data("jmol")){var h=g.data("jmol");if(typeof d=="string"){switch(d){case"hide":g.find("object").css("width","2px");g.find("object").css("height","2px");break;case"show":g.find("object").css("width",h.options["width"]+"px");g.find("object").css("height",h.options["height"]+"px");break;case"destroy":h._destroy();g.find("object").remove();g.data("jmol",null);break;case"option":var i=arguments[1];if(typeof i=="string"){var k=arguments[2];if(typeof k!="undefined"){m(g,h,i,k)}}else if(typeof i=="object"){l(g,h,i)}break}}else if(typeof d=="object"){l(g,h,d)}}else{var o=a.extend({},c,{});if(typeof d=="object"){o=a.extend(o,d||{})}j++;var p=g.attr("id");if(typeof p=="undefined"){p="jmolApplet"+j;g.attr("id",p)}var h=new b(p,o);if(o["menuUrl"]!=null&&o["menuUrl"].length>0){h.script("load MENU "+o["menuUrl"])}if(o["modelUrl"]!=null&&o["modelUrl"].length>0){h.script("load "+o["modelUrl"])}if(o["onSync"]!=null){h._setCallback("sync")}g.html(n("_"+p,o));g.data("jmol",h)}})},l=function(a,b,c){for(var d in c){m(a,b,d,c[d])}},m=function(a,b,c,d){switch(c){case"background":b.script("background "+d.replace("#","x"));break;case"menuUrl":b.script('load MENU "'+d+'"');break;case"modelUrl":b.script('load "'+d+'"');break;case"onSync":b.setCallback("sync");break;case"width":a.find("object").css("width",d+"px");break;case"height":a.find("object").css("width",d+"px");break}b.options[c]=d},n=function(a,b){var c="";if(navigator.userAgent){if(navigator.userAgent.indexOf("MSIE")!=-1){c=' classid="'+h+'" codebase="'+i+'"'}}var j="";if(navigator.platform){if(navigator.platform.indexOf("Mac")!=-1){j='<param name="UseCommandThread" value="true">'}}j+=g["ready"];if(b["onEval"]!==null){j+=g["eval"]}var k=f.replace("%add_attr%",c);k=k.replace("%add_param%",j);k=k.replace("%sync_id%",(""+Math.random()).substring(3));k=k.replace("%id%",a);k=k.replace("%name%",a);k=k.replace("%width%",b["width"]);k=k.replace("%height%",b["height"]);k=k.replace("%applet_url%",b["appletUrl"]);k=k.replace("%applet_file%",b["useSigned"]?e:d);k=k.replace("%java_args%","-Xmx"+b["memLimit"]+"m");k=k.replace("%bg_color%",b["background"]);return k},o=function(b,c){var d=Array.prototype.shift;var e=Array.prototype.unshift;var f=d.call(c);var g=a("#"+f.substr(1));if(g.data("jmol")){var h=g.data("jmol");switch(b){case"ready":if(c[1]){h._ready(c[2]);if(h.options["onReady"]!=null){h.options.onReady(h)}}else{if(h.options["onDestroy"]!=null){h.options.onDestroy()}}break;case"eval":if(h.options["onEval"]!=null){h.options.onEval(h,c)}break;case"sync":if(h.options["onSync"]!=null){return h.options.onSync(h,c)}return 1;break}}},p=function(b,c){var d=Array.prototype.shift;var e=Array.prototype.unshift;var f=d.call(c);var g=a("#"+f.substr(1));if(g.data("jmol")){var h=g.data("jmol");var i=a.Event("jmol_"+b);var j=[h];if(b=="animate"){j.push({frameIdx:c[0],fileNum:c[1],modelNum:c[2],firstFrame:c[3],lastFrame:c[4],animState:c[5],animDir:c[6],direction:c[7]})}else if(b=="hover"||b=="pick"){j.push({label:c[0],atomIdx:c[1]})}else if(b=="load"){j.push({fileUrl:c[0],fileName:c[1],title:c[2],errorMsg:c[3],status:c[4],frameBefore:c[5],frameLast:c[6]})}else if(b=="minimize"){j.push({status:c[0],iteration:c[1],energy:c[2],energyDelta:c[3]})}else if(b=="measure"){j.push({label:c[0],status:c[2],value:c[3]})}else if(b=="echo"||b=="message"||b=="script"){j.push(c[0])}else if(b=="resize"){j.push({width:c[0],height:c[0]})}g.triggerHandler(i,j)}};var q=a.event.add;a.event.add=function(b,c,d,e){a(b).each(function(b,d){if(a(d).data("jmol")){var e=a(d).data("jmol");var f=c.split(" ");for(var g in f){switch(f[g]){case"jmol_animate":case"jmol_echo":case"jmol_hover":case"jmol_load":case"jmol_measure":case"jmol_message":case"jmol_minimize":case"jmol_pick":case"jmol_resize":case"jmol_script":e._setCallback(f[g].substr(5));break}}}});return q(b,c,d,e)};var r=a.event.remove;a.fn.remove=function(b,c,d,e){a(b).each(function(b,d){if(a(d).data("jmol")){var e=a(d).data("jmol");var f=c.split(" ");for(var g in f){switch(f[g]){case"jmol_animate":case"jmol_echo":case"jmol_hover":case"jmol_load":case"jmol_measure":case"jmol_message":case"jmol_minimize":case"jmol_pick":case"jmol_resize":case"jmol_script":e._removeCallback(f[g].substr(5));break}}}});return r(b,c,d,e)};return{process:k,callbacks:{eval:function(){o("eval",arguments)},sync:function(){return o("sync",arguments)},message:function(){p("message",arguments)},echo:function(){p("echo",arguments)},script:function(){p("script",arguments)},ready:function(){o("ready",arguments)},load:function(){p("load",arguments)},hover:function(){p("hover",arguments)},pick:function(){p("pick",arguments)},measure:function(){p("measure",arguments)},animate:function(){p("animate",arguments)},minimize:function(){p("minimize",arguments)},resize:function(){p("resize",arguments)}}}}();a.fn.extend({jmol:c.process});a.extend({jmol:c.callbacks})})(jQuery)